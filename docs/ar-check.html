<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>AR 動作チェック</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css" />
</head>

<body>
<h2>AR動作チェック</h2>

<ul id="result">
  <li>HTTPSチェック：⏳</li>
  <li>WebXR対応：⏳</li>
  <li>immersive-ar対応：⏳</li>
  <li>hit-test対応：⏳</li>
</ul>

<div id="guide"></div>

<button id="goMeasure" style="display:none"
        onclick="location.href='measure.html'">
  計測を開始
</button>

<button onclick="location.href='index.html'">戻る</button>

<script>
const items = document.querySelectorAll("#result li");
const guide = document.getElementById("guide");
const goBtn = document.getElementById("goMeasure");

(async () => {

  // ① HTTPSチェック
  if (location.protocol === "https:") {
    items[0].innerText = "HTTPSチェック：✅ OK";
  } else {
    items[0].innerText = "HTTPSチェック：❌ HTTPS必須";
    guide.innerHTML += "<p>HTTPSで開いてください（GitHub Pages推奨）</p>";
    return;
  }

  // ② WebXRチェック
  if (!navigator.xr) {
    items[1].innerText = "WebXR対応：❌ 非対応";
    guide.innerHTML += "<p>Chrome / Android推奨</p>";
    return;
  }
  items[1].innerText = "WebXR対応：✅ OK";

  // ③ immersive-ar チェック
  const arSupported =
    await navigator.xr.isSessionSupported("immersive-ar");

  if (!arSupported) {
    items[2].innerText = "immersive-ar対応：❌ 未対応";
    guide.innerHTML += `
      <p>Chromeの設定を確認してください</p>
      <ul>
        <li>chrome://flags → WebXR Incubations</li>
        <li>chrome://flags → WebXR Hit Test</li>
      </ul>
    `;
    return;
  }
  items[2].innerText = "immersive-ar対応：✅ OK";

  // ④ hit-test チェック（重要）
  try {
    await navigator.xr.requestSession("immersive-ar", {
      requiredFeatures: ["hit-test"]
    }).then(s => s.end());

    items[3].innerText = "hit-test対応：✅ OK";
    guide.innerHTML += "<p>AR計測が可能です！</p>";
    goBtn.style.display = "block";

  } catch (e) {
    items[3].innerText = "hit-test対応：❌ 取得不可";
    guide.innerHTML += "<p>端末が対応していない可能性があります</p>";
  }

})();
</script>

</body>
</html>
